<!DOCTYPE html>
<html>
<body>
<h1>This is my  Web Messaging testing page v004</h1>
<p>I'm hosted with GitHub Pages.</p>
</body>


<script type="text/javascript" charset="utf-8">
  (function (g, e, n, es, ys) {
    g['_genesysJs'] = e;
    g[e] = g[e] || function () {
      (g[e].q = g[e].q || []).push(arguments)
    };
    g[e].t = 1 * new Date();
    g[e].c = es;
    ys = document.createElement('script'); ys.async = 1; ys.src = n; ys.charset = 'utf-8'; document.head.appendChild(ys);
  })(window, 'Genesys', 'https://apps.mypurecloud.jp/genesys-bootstrap/genesys.min.js', {
    environment: 'apne1',
    deploymentId: '86d50ece-2f54-41e1-9965-006bb5386d1d'
  });
  //Notification Start----->
  Notification.requestPermission().then(function (permission) {
          // If the user accepts, let's create a notification
          if (permission === "granted") {
              console.log("notification permission granted")
          }
      });

      Genesys("subscribe", "MessagingService.messagesReceived", function (o) {
          console.log(o)
          try {
              if (sessionStorage.getItem('gc_widget') === 'false' && o.data.messages[0].direction === 'Outbound') {
                  var notification = new Notification("New Message", { tag: "genesys", body: o.data.messages[0].text, icon: "https://dhqbrvplips7x.cloudfront.net/contact-center/5000-5000/img/favicon.ico" });
                  Genesys("command", "Messenger.open")
                  return
              }
              if (document.hasFocus() === false) {
                  var notification = new Notification("New Message", { tag: "genesys", body: o.data.messages[0].text, icon: "https://dhqbrvplips7x.cloudfront.net/contact-center/5000-5000/img/favicon.ico" });
                  Genesys("command", "Messenger.open")
              }
          } catch (err) {
              console.error(err)
          }
          try {
                if (o.data.messages[0].text === 'iFrame') {
                    console.log('iFrame popup detected')
                    popIframe()
                }
            } catch (err) {
                console.error(err)
            }
      });
      Genesys("subscribe", "Conversations.closed", function (o) { sessionStorage.setItem('gc_widget', 'false') });
      Genesys("subscribe", "Conversations.opened", function (o) { sessionStorage.setItem('gc_widget', 'true') });
      
      //Notification End----->

      //Bootstrap iFrame Invite
      function popIframe() {
            document.getElementById('iFramePop').className = 'toast show'
        }

        //Bootstrap iFrame Invite
        function closeIframe() {
            document.getElementById('iFramePop').className = 'toast hide'
        }

        //JavaScript Native way to get Url Parameters for config
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, '$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }
</script>

<script src="inviteform.js" defer></script>

<div class="row align-items-center">
  <h1 style="text-align: center;">Genesys WebMessaging iFrame popup</h1>
</div>
<div class="container">
  <br>
  <button onclick="openChat()" class="btn btn-secondary">Open Chat</button>
  <button onclick="closeChat()" class="btn btn-secondary">Close Chat</button>
  <br>
  <br>
  <button onclick="popIframe()" class="btn btn-secondary">Pop Invite</button>
  <button onclick="closeIframe()" class="btn btn-secondary">Close Invite</button>
</div>

<!--Visuals for the popup window you can change the colors to suit the widget-->
<div class="position-absolute top-50 start-50 translate-middle" style="z-index: 999999999">
  <div id="iFramePop" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true"
      style="height: 35rem">
      <div class="toast-header" style="background-color: #3b6aaf;">
          <strong class="me-auto" style="color: white;">iFrame</strong>
          <button type="button" class="btn-close btn-close-white" aria-label="Close"
              onclick="closeIframe(); setData('iframePop', 'done')"></button>
      </div>
      <div id="iFramePopBody" class="toast-body" style="height: 100%;">
          <!--For the example im getting the URL from a parameter this could be statically set or pulled from teh page etc in the real world-->
          <iframe id="iFrameSrc" src="" height="100%" width="100%"></iframe>
      </div>
  </div>
</div>

<script>
  //For the example im getting the URL from a parameter this could be statically set or pulled from the page etc in the real world
  document.getElementById('iFrameSrc').src = getParameterByName('iframe')
</script>

</html>